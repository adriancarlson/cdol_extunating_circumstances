<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Extenuating Circumstances Student List</title>
        <link href="/images/css/cdol_bootstrap.css?~[time]" rel="stylesheet" media="screen">
        ~[wc:commonscripts]
        <link href="/images/css/screen.css?~[time]" rel="stylesheet" media="screen">
        <link href="/images/css/print.css?~[time]" rel="stylesheet" media="print">
        <link href="/images/css/cdol.css?~[time]" rel="stylesheet" media="screen">
        <link href="/images/css/cdol_print.css?~[time]" rel="stylesheet" media="print">
        <script type="text/javascript">
            require(['angular', 'components/shared/index'], function (angular) {
                let extenuatingCircumstances = angular.module('extenuatingCircumstances', ['powerSchoolModule']);
                extenuatingCircumstances.controller('extenuatingCircumstancesCtrl', function ($scope, $http) {
                    //This is here for troubleshooting purposes.
                    //Allows us to double click anywhere on the page and logs scope to console
                    $j(document).dblclick(() => console.log($scope));

                    $scope.curSchoolId = $attrs.ngCurSchoolId
                    // $scope.loadData = async => {
                    //     loadingDialog()
                    //     $scope.mainSpinner = true
                    //     $scope.extenuatingCircumstancesCounts = {}
                    //     $scope.extenuatingCircumstancesList = {}
                    //     $scope.curSelectionCounts = {}
                    //     $scope.curSelection = {}
                    //     $scope.curSelectionDcids = {}
                    //     $scope.selectedRemoveStudentDcids = []
                    //     $scope.useHandStudentSelectionRemove = false
                    //     $scope.selectedAddStudent = []
                    //     $scope.selectedAddStudentDcids = []
                    //     $scope.useHandStudentSelectionAdd = false
                    //     $scope.showAddStudentTable = false

                    //     //setting up arguments for PQ call
                    //     const pqData = { schoolID: $scope.curSchoolId }

                    //     const removeDuplicates = records => {
                    //         // Use reduce to accumulate records by dcid
                    //         const uniqueRecords = records.reduce((acc, record) => {
                    //             // If the dcid is not in the accumulator, or the current record's ssdcid is higher, update the accumulator
                    //             if (!acc[record.dcid] || acc[record.dcid].ssdcid < record.ssdcid) {
                    //                 acc[record.dcid] = record
                    //             }
                    //             return acc
                    //         }, {})

                    //         // Convert the accumulator object back into an array
                    //         return Object.values(uniqueRecords)
                    //     }

                    //     // getting existing users with license
                    //     let res = await pqService.getPQResults(`net.cdolinc.powerschool.attendance.extenuating_circumstances`, pqData)
                    //     res = removeDuplicates(res)
                    //     $scope.extenuatingCircumstancesList = res
                    //     $scope.extenuatingCircumstancesList = Object.values(
                    //         $scope.extenuatingCircumstancesList.reduce((acc, record) => {
                    //             // If the dcid is not in the accumulator, or the current record's ssdcid is higher, update the accumulator
                    //             if (!acc[record.dcid] || acc[record.dcid].ssdcid < record.ssdcid) {
                    //                 acc[record.dcid] = record
                    //             }
                    //             return acc
                    //         }, {})
                    //     )
                    //     // Calculate the number of records where license_adobe == '1'
                    //     $scope.extenuatingCircumstancesCounts = $scope.extenuatingCircumstancesCounts || {}

                    //     // getting current selection
                    //     let curSelectRes = await pqService.getPQResults(`net.cdolinc.powerschool.${userType}.licensing`, pqData, true)
                    //     curSelectRes = removeDuplicates(curSelectRes)
                    //     if (curSelectRes.length > 0) {
                    //         $scope.curSelection[userType] = curSelectRes
                    //         $scope.curSelectionCounts[userType] = $scope.curSelection[userType].length
                    //         $scope[`selectedAdd${userType}`] = []
                    //         $scope[`selectedAdd${userType}Dcids`] = []
                    //         $scope.curSelectionDcids[userType] = []
                    //         angular.forEach($scope.curSelection[userType], function (user) {
                    //             user.selectToAdd = true
                    //             $scope[`selectedAdd${userType}`].push(user)
                    //             $scope[`selectedAdd${userType}Dcids`].push(user.dcid)
                    //             $scope.curSelectionDcids[userType].push(user.dcid)
                    //             $scope.selectAllAddChecked = true
                    //         })
                    //     } else {
                    //         $scope.curSelection[userType] = {}
                    //         $scope.curSelectionCounts[userType] = 0
                    //     }
                    //     $scope.mainSpinner = false
                    //     $scope.$digest()
                    //     closeLoading()
                    // }


                }); //End Controller
            }); //End Require
        </script>
    </head>

    <body>
        ~[wc:admin_header_css]
        ~[wc:admin_navigation_css]
        <div id="extenuating-circumstances-app-div" data-require-path="components/shared/index"
            data-module-name="extenuatingCircumstancesMod" data-ng-controller="extenuatingCircumstancesCtrl"
            data-ng-cur-school-id="~(curschoolid)" data-ng-cloak>
            <h1 class="mb-1">Extenuating Circumstances Student List</h1>
            <div id="noTimer" pss-feedback-widget success="getSuccessMessages()"></div>
            <div class="btn-toolbar justify-content-between ms-3 me-4" role="toolbar" data-ng-show="!mainSpinner">
                <div class="input-group">
                    <button data-ng-click="addCollapsedClass('studentsHeader', 'students')"
                        data-ng-disabled="curSelectionCounts.students < 1">
                        Load Currently Selected Students ({{curSelectionCounts.students}})
                    </button>
                </div>
            </div>
            <div id="wait-spinner-div" data-ng-show="mainSpinner" class="m-3">
                <div data-pss-wait-spinner="large" style="background-color: transparent;"></div>
            </div>
            <student-list id="tabstudents" data-ng-show="userType === 'students'"></student-list>
            <user-list id="tabusers" data-ng-show="userType === 'users'"></user-list>
        </div>
        ~[wc:admin_footer_css]
    </body>

</html>